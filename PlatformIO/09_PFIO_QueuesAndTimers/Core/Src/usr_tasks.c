/*##############################################################################################################################################*/
/*INCLUDES______________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/

#include "main.h"

/*##############################################################################################################################################*/
/*GLOBALS_______________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/

const char *invalidMsg = "/-----------Invalid Option-----------/\n";

/*##############################################################################################################################################*/
/*DEFINES_______________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/



/*##############################################################################################################################################*/
/*EXTERNS_______________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/

extern input_zInputCommand_t inputCmd;

/*##############################################################################################################################################*/
/*TYPEDEFS/STRUCTS/ENUMS________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/



/*##############################################################################################################################################*/
/*FUNCTION DECLARATIONS_________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/

void usrtsk_ProcessCmd( input_zInputCommand_t *cmd );
void usrtsk_ExtractCmd( input_zInputCommand_t *cmd );

/*##############################################################################################################################################*/
/*FUNCTIONS_____________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/

/**
 * @brief Function to Create Menu GUI String and wait for User Input
 * 
 * @param param 
 */
void usrtsk_MenuTask( void *param )
{
    while( 1 )
    {

    }
}

/**
 * @brief Function to handle User Input
 * 
 * @param param 
 */
void usrtsk_InputHandleTask( void *param )
{
    BaseType_t status;
    while( 1 )
    {
        /*Wait for Notification*/
        status = xTaskNotifyWait( 0, 0, NULL, portMAX_DELAY );
        if( status == pdTRUE )
        {
            /*Notifcation Has been received*/
            usrtsk_ProcessCmd( &inputCmd );
        }

    }
}

/**
 * @brief Function to Print the GUI of Main, LED, and RTC
 * 
 * @param param 
 */
void usrtsk_PrintGUITask( void *param )
{
    while( 1 )
    {
        
    }
}

/**
 * @brief Function to create the LED GUI and wait for User input
 * 
 * @param param 
 */
void usrtsk_LEDTask( void *param )
{
    while( 1 )
    {
        
    }
}

/**
 * @brief Function to create the RTC GUI and wait for User Input
 * 
 * @param param 
 */
void usrtsk_RTCTask( void *param )
{
    while( 1 )
    {
        
    }
}

void usrtsk_ProcessCmd( input_zInputCommand_t *cmd )
{
    
    usrtsk_ExtractCmd( cmd );

    switch( currAppState )
    {
        case sMainMenu:
        {
            xTaskNotify( tskHdl_zMenuTask, ( uint32_t )cmd, e)
        }
    }

}

/**
 * @brief Function to extract the data bytes from the Queue and form a Command
 * 
 * @param cmd 
 */
void usrtsk_ExtractCmd( input_zInputCommand_t *cmd )
{
    uint8_t msg;
    BaseType_t numMsgs;

    numMsgs = uxQueueMessagesWaiting( queueHdl_zInputData );
    if( numMsgs == 0 )
    {
        /*No Messages in Queue*/
        return;
    }
    else
    {
        /*Messages in Queue*/
        for( uint8_t i = 0; i < numMsgs; i++ )
        {
            xQueueReceive( queueHdl_zInputData, &msg, 0 );
            taskENTER_CRITICAL( );
            cmd->payload[ i ] = msg;
            taskEXIT_CRITICAL( );
        }
        taskENTER_CRITICAL( );
        cmd->len = numMsgs - 1;
        cmd->payload[ numMsgs - 1 ] = '\0';
        taskEXIT_CRITICAL( );
    }
}